<app-search-filter></app-search-filter>
<ng-container *ngIf="account.signedIn">
  <div class="submit-button" routerLink="/submit" [queryParams]="{ tag: localTag }">
    🔗 Submit Link
  </div>
  <div class="submit-button" routerLink="/submit/text" [queryParams]="{ tag: localTag }">
    📝 Submit Text Post
  </div>
</ng-container>
<ng-container *ngIf="account.mod">
  <div class="submit-button" routerLink="/create/ext" [queryParams]="ext ? null : { tag: localTag }">
    🖌️ Create Tag Extension
  </div>
  <div class="submit-button" routerLink="/submit" [queryParams]="{ tag: localTag, linkType: 'feed' }">
    📰 Submit Feed
  </div>
  <div class="submit-button" routerLink="/create/user" [queryParams]="{ tag: localTag }">
    🗝️ Create User Permissions
  </div>
</ng-container>
<ng-container *ngIf="account.admin">
  <div class="submit-button" routerLink="/admin/origin/create">
    🔧 Replicate Remote Origin
  </div>
</ng-container>
<ng-container *ngIf="admin.status.plugins.inbox && user">
  <div class="submit-button" routerLink="/submit/dm" [queryParams]="{ to: ext?.tag }">
    ✉️Send Direct Message
  </div>
</ng-container>
<div class="tag-header">
  <h3><a class="tag" [routerLink]="['/tag', tag]">{{ ext?.name || tag }}</a></h3>
  <ng-container *ngIf="tag && admin.status.templates.user">
    <button *ngIf="inSubs$ | async as inSubs; else notInSubs" (click)="unsubscribe()">&ndash; unsubscribe</button>
    <ng-template #notInSubs>
      <button (click)="subscribe()">+ subscribe</button>
    </ng-template>
  </ng-container>
</div>

<ng-container *ngIf="queue">
  <div *ngIf="ext?.config?.bounty">
    Bounty: {{ ext?.config?.bounty }}
  </div>
  <div *ngIf="ext?.config?.maxAge">
    Max Age: {{ ext?.config?.maxAge }}
  </div>
  <div *ngIf="ext?.config?.approvers?.length">
    Approvers:
    <br>
    <ng-container *ngFor="let a of ext!.config!.approvers!">
      <a class="tag" [routerLink]="['/tag', a]">
        {{ a }}
      </a>
      <br>
    </ng-container>
  </div>
  <div *ngIf="isApprover">
    <a [routerLink]="['/tag', prefix('plugin/invoice/', ext!.tag)]">invoices</a>
  </div>
</ng-container>

<ng-container *ngIf="user">
  <div *ngIf="ext?.config?.subscriptions?.length">
    Subscribed to:
    <br>
    <ng-container *ngFor="let sub of ext!.config!.subscriptions!">
      <a class="tag" [routerLink]="['/tag', sub]">
        {{ sub }}
      </a>
      <br>
    </ng-container>
  </div>
</ng-container>

<ng-container *ngIf="root">
  <div *ngIf="ext?.config?.sidebar"
       class="md"
       markdown
       [emoji]="!!admin.status.plugins.emoji"
       [katex]="!!admin.status.plugins.latex"
       [katexOptions]="{ throwOnError: false }"
       [data]="ext?.config?.sidebar"></div>

  <ng-container *ngIf="writeAccess$ | async">
    <a *ngIf="ext"
       class="sidebar-link"
       [routerLink]="['/tag', localTag, 'edit']">
      edit
    </a>
  </ng-container>
</ng-container>

<input type="search"
       placeholder="Search"
       [ngModel]="search$ | async"
       (keydown)="$event.key === 'Enter' && search() || true">
<label for="sources">Filters:</label>
<div id="sources" class="form-group">
  <button type="button" (click)="addFilter()">+ Add filter</button>

  <div *ngFor="let f of filters; let i=index">
    <label for="filter-{{ i }}">Filter:</label>
    <select id="filter-{{ i }}" [ngModel]="filters[i]" (ngModelChange)="setFilter(i, $event)">
      <option *ngFor="let opt of allFilters" [value]="opt">{{ opt }}</option>
    </select>
    <button type="button" (click)="removeFilter(i)">&ndash;</button>
  </div>
</div>
<ng-container *ngIf="account.signedIn">
  <div class="submit-button" routerLink="/submit" [queryParams]="{ localTag }">
    Submit Link
  </div>
  <div class="submit-button" routerLink="/submit/text" [queryParams]="{ localTag }">
    Submit Text Post
  </div>
</ng-container>
<ng-container *ngIf="account.mod">
  <div class="submit-button" routerLink="/create/ext" [queryParams]="ext ? null : { localTag }">
    Create Tag Extension
  </div>
  <div class="submit-button" routerLink="/submit" [queryParams]="{ localTag, linkType: 'feed' }">
    Submit Feed
  </div>
  <div class="submit-button" routerLink="/create/user" [queryParams]="{ localTag }">
    Create User Permissions
  </div>
</ng-container>
<ng-container *ngIf="account.admin">
  <div class="submit-button" routerLink="/admin/origin/create">
    Replicate Remote Origin
  </div>
</ng-container>

<ng-container *ngIf="tag && admin.status.templates.user">
  <button *ngIf="inSubs$ | async as inSubs; else notInSubs" (click)="unsubscribe()">unsubscribe</button>
  <ng-template #notInSubs>
    <button class="fake-link" (click)="subscribe()">subscribe</button>
  </ng-template>
</ng-container>

<ng-container *ngIf="queue">
  <div *ngIf="ext?.config?.bounty">
    Bounty: {{ ext?.config?.bounty }}
  </div>
  <div *ngIf="ext?.config?.maxAge">
    Max Age: {{ ext?.config?.maxAge }}
  </div>
  <div *ngIf="ext?.config?.approvers?.length">
    Approvers:
    <br>
    <ng-container *ngFor="let a of ext!.config!.approvers!">
      <a [routerLink]="['/tag', a]">
        {{ a }}
      </a>
      <br>
    </ng-container>
  </div>
  <div *ngIf="isApprover">
    <a [routerLink]="['/tag', prefix('plugin/invoice/', ext!.tag)]">invoices</a>
  </div>
</ng-container>

<ng-container *ngIf="user">
  <div *ngIf="admin.status.plugins.inbox && !ext?.origin">
    <a routerLink="/submit/dm" [queryParams]="{ to: ext?.tag }">Send Direct Message</a>
  </div>
  <div *ngIf="ext?.config?.subscriptions?.length">
    Subscribed to:
    <br>
    <ng-container *ngFor="let sub of ext!.config!.subscriptions!">
      <a [routerLink]="['/tag', sub]">
        {{ sub }}
      </a>
      <br>
    </ng-container>
  </div>
</ng-container>

<ng-container *ngIf="root">
  <div *ngIf="ext?.config?.sidebar"
       class="md"
       markdown
       [emoji]="!!admin.status.plugins.emoji"
       [katex]="!!admin.status.plugins.latex"
       [katexOptions]="{ throwOnError: false }"
       [data]="ext?.config?.sidebar"></div>

  <ng-container *ngIf="writeAccess$ | async">
    <a *ngIf="ext"
       class="sidebar-edit"
       [routerLink]="['/tag', localTag, 'edit']">
      edit
    </a>
  </ng-container>
</ng-container>

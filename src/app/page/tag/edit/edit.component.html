<div class="tabs">
  <div class="spacer"></div>
  <app-settings></app-settings>
</div>

<form *ngIf="editForm" class="form" [formGroup]="editForm" (ngSubmit)="save()">

  <label for="tag">Tag:</label>
  <input id="tag" type="text" formControlName="tag" [attr.disabled]="true">

  <label for="name">Name:</label>
  <input id="name" type="text" formControlName="name">

  <ng-container *ngIf="root">
    <label for="sidebar">Sidebar:</label>
    <div class="editor-preview">
      <textarea id="sidebar" [formControl]="sidebar"></textarea>
      <app-embed [comment]="sidebar.value"></app-embed>
    </div>

    <label for="pinned">Pinned:</label>
    <div id="pinned" class="form-group">
      <button type="button" (click)="addPinned()">+ Add another pinned link</button>

      <div *ngFor="let pin of pinned.controls; let i=index">
        <label for="pinned-{{ i }}">Link:</label>
        <input id="pinned-{{ i }}" type="text" [formControl]="$any(pin)">
        <button type="button" (click)="removePinned(i)">&ndash;</button>
        <div class="error" *ngIf="pinned.at(i).touched && pinned.at(i).errors?.['required']">
          Pinned link must not be blank.
        </div>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="user">
    <label for="subscriptions">Subscriptions:</label>
    <div id="subscriptions" class="form-group">
      <button type="button" (click)="addSub()">+ Add another subscription</button>

      <div *ngFor="let sub of subscriptions.controls; let i=index">
        <label for="sub-{{ i }}">Tag:</label>
        <input id="sub-{{ i }}"
               type="email"
               autocorrect="off"
               autocapitalize="none"
               [formControl]="$any(sub)">
        <button type="button" (click)="removeSub(i)">&ndash;</button>
        <div class="error" *ngIf="subscriptions.at(i).touched && subscriptions.at(i).errors?.['pattern']">
          Tags must be lower case letters and forward slashes. Tags may be qualified with an origin. Must not start with a slash or contain
          two forward slashes in a row. Private tags start with an underscore.<br>
          (i.e. "science", "science@origin" "my/tag", or "_my/private/tag")
        </div>
        <div class="error" *ngIf="subscriptions.at(i).touched && subscriptions.at(i).errors?.['required']">
          Tag must not be blank.
        </div>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="queue">
    <label for="maxAge">Max Age:</label>
    <input type="text" id="maxAge" [formControl]="maxAge">

    <label for="bounty">Bounty:</label>
    <input type="text" id="bounty" [formControl]="bounty">

    <label for="approvers">Approvers:</label>
    <div id="approvers" class="form-group">
      <button type="button" (click)="addApprover()">+ Add another approver</button>

      <div *ngFor="let approver of approvers.controls; let i=index">
        <label for="approver-{{ i }}">User:</label>
        <input id="approver-{{ i }}"
               type="email"
               autocorrect="off"
               autocapitalize="none"
               [formControl]="$any(approver)">
        <button type="button" (click)="removeApprover(i)">&ndash;</button>
        <div class="error" *ngIf="approvers.at(i).touched && approvers.at(i).errors?.['pattern']">
          User tags must start with the "user/" or "_user/" prefix.
          Tags must be lower case letters and forward slashes. Must not start with a slash or contain two forward slashes in a row. Private
          tags start with an underscore.<br>
          (i.e. "science", "my/tag", or "_my/private/tag")
        </div>
        <div class="error" *ngIf="approvers.at(i).touched && approvers.at(i).errors?.['required']">
          Tag must not be blank.
        </div>
      </div>
    </div>
  </ng-container>

  <ng-container *ngFor="let e of serverError">
    <span><!-- Unexpected Error --></span>
    <div class="error">{{ e }}</div>
  </ng-container>

  <span><!-- Buttons --></span>
  <span class="form-group">
    <button type="submit" [disabled]="submitted && !editForm.valid">Save</button>
  </span>

</form>

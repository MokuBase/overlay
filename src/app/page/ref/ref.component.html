<ng-container *mobxAutorun>
  <div class="tabs">
    <a routerLink="./" [queryParams]="{origin: store.view.origin}" [class.current-tab]="!store.view.current">summary</a>
    <ng-container *ngIf="store.view.ref?.created">
      <ng-container *ngIf="admin.status.plugins.comment && store.view.ref!.metadata?.plugins?.['plugin/comment']">
        <a routerLink="./comments" [queryParams]="{origin: store.view.origin}" routerLinkActive="current-tab">comments</a>
      </ng-container>
      <ng-container *ngIf="store.view.ref!.metadata?.responses">
        <a routerLink="./responses" [queryParams]="{origin: store.view.origin}" routerLinkActive="current-tab">responses</a>
      </ng-container>
      <ng-container *ngIf="store.view.ref!.sources?.length">
        <a routerLink="./sources" [queryParams]="{origin: store.view.origin}" routerLinkActive="current-tab">sources</a>
        <a routerLink="./missing" [queryParams]="{origin: store.view.origin}" routerLinkActive="current-tab">missing sources</a>
      </ng-container>
      <ng-container *ngIf="store.view.ref!.alternateUrls?.length">
        <a routerLink="./alts" [queryParams]="{origin: store.view.origin}" routerLinkActive="current-tab">alts</a>
      </ng-container>
      <ng-container *ngIf="error && store.view.versions || store.view.versions > 1">
        <a routerLink="./versions" [queryParams]="{origin: store.view.origin}" routerLinkActive="current-tab">versions</a>
      </ng-container>
    </ng-container>
    <app-settings></app-settings>
  </div>
  <app-sidebar class="aside"></app-sidebar>
  <ng-container *ngIf="store.view.ref else loading">
    <app-ref class="full-page"
             [ref]="store.view.ref"
             [showToggle]="true"
             [expandInline]="true"
             [expanded]="store.local.isRefToggled(store.view.url, !!store.view.ref.comment)"></app-ref>
    <div *ngIf="refWarning"
         class="warning">
      * Published date was changed to be after source published date.
    </div>
  </ng-container>
  <ng-template #loading>
    <app-loading></app-loading>
  </ng-template>
  <ng-container *ngIf="error">
    <ng-container *ngIf="error!.status === 404">
      <div class="stack">
        <div class="error-404">Not Found</div>
        <ng-container *ngIf="store.account.signedIn">
          <div *ngIf="!store.view.isTextPost && !isWiki(store.view.url)" class="error-404 submit-button" routerLink="/submit" [queryParams]="{ url: store.view.url }">
            🔗 Submit Link
          </div>
          <div *ngIf="store.view.isTextPost" class="error-404 submit-button" routerLink="/submit/text" [queryParams]="{ url: store.view.url }">
            📝 Submit Text Post
          </div>
          <div *ngIf="isWiki(store.view.url)" class="error-404 submit-button" routerLink="/submit/text" [queryParams]="{ url: store.view.url }">
            📔 &nbsp; Submit Wiki
          </div>
        </ng-container>
      </div>
    </ng-container>
    <div *ngIf="error!.status !== 404" class="error">{{ printError(error!) }}</div>
  </ng-container>
  <ng-container *ngIf="store.view.ref?.created">
    <hr>
    <router-outlet></router-outlet>
  </ng-container>
</ng-container>

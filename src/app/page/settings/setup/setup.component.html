<div class="row">
  <form class="form" [formGroup]="adminForm" (ngSubmit)="install()">
    <span><!-- Title --></span>
    <h2 i18n>Install Plugins and Templates</h2>
    <span><!-- Description --></span>
    <p i18n>
      Quickly turn on and off templates bundled with this client.
      Visit the <a routerLink="../plugin">plugins</a> or
      <a routerLink="../template">templates</a> settings page to manage all
      plugins and templates.
    </p>

    <span><!-- Buttons --></span>
    <span class="form-array right">
      <button type="button" (click)="oembed.defaults().subscribe()" i18n>🔁️ oEmbed defaults</button>
      <button type="button" (click)="updateAll()" *ngIf="store.view.updates" i18n>🌟️ Update All</button>
      <button type="button" (click)="selectAll()" *ngIf="selectAllToggle" i18n>Select None</button>
      <button type="button" (click)="selectAll()" *ngIf="!selectAllToggle" i18n>Select All</button>
      <button type="submit" [disabled]="submitted && !adminForm.valid" i18n>Save</button>
    </span>

    <ng-container *ngIf="serverError.length || installMessages.length">
      <span class="mobile-block"><!-- Log --></span>
      <div class="log mobile-block">
        <div *ngFor="let e of serverError" class="error">{{ e }}</div>
        <div *ngFor="let i of installMessages">{{ i }}</div>
      </div>
    </ng-container>

    <h3 i18n>Mods:</h3>
    <div class="bubble">
      <div formGroupName="mods" class="form">
        <ng-container *ngFor="let group of modGroups | keyvalue">
          <label [style.text-transform]="'capitalize'" i18n>{{ group.key }}</label>
          <div>
            <ng-container *ngFor="let e of group.value">
              <div *ngIf="experiments || !e[1].config?.experimental" [title]="e[1]!.config!.description || ''" class="nowrap">
                <input id="mod-{{ e[0] }}" type="checkbox" [formControlName]="e[0]">
                <label for="mod-{{ e[0] }}" [title]="e[1]!.config!.description || ''">{{ e[1].config!.mod }}</label>
                <span *ngIf="e[1].config!.experimental">🧪️</span>
                <span *ngIf="needsModUpdate(e[1].config!.mod!)" class="update">
                <span class="fake-link no-select" (click)="updateMod(e[1].config!.mod!)" i18n>🌟️ update</span>
              </span>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>
    </div>

    <h3 i18n>Templates:</h3>
    <div class="bubble">
      <div formGroupName="mods" class="form">
        <ng-container *ngFor="let group of templateGroups | keyvalue">
          <label [style.text-transform]="'capitalize'" i18n>{{ group.key }}</label>
          <div>
            <ng-container *ngFor="let e of group.value">
              <div *ngIf="experiments || !e[1].config?.experimental || admin.status.templates[e[0]]" [title]="e[1].config?.description || ''" class="nowrap">
                <input id="template-{{ e[0] }}" type="checkbox" [formControlName]="e[0]">
                <label for="template-{{ e[0] }}" [title]="e[1].config?.description || ''">{{ e[1].name || e[0] || e[1].tag }}</label>
                <span *ngIf="e[1].config?.experimental">🧪️</span>
                <span *ngIf="needsTemplateUpdate(e[0])" class="update">
                <span class="fake-link no-select" (click)="updateTemplate($any(e[0]))" i18n>🌟️ update</span>
              </span>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>
    </div>

    <h3 i18n>Plugins:</h3>
    <div class="bubble">
      <div formGroupName="mods" class="form">
        <ng-container *ngFor="let group of pluginGroups | keyvalue">
          <label [style.text-transform]="'capitalize'" i18n>{{ group.key }}</label>
          <div>
            <ng-container *ngFor="let e of group.value">
              <div *ngIf="experiments || !e[1].config?.experimental || admin.status.plugins[e[0]]" [title]="e[1].config?.description || ''" class="nowrap">
                <input id="plugin-{{ e[0] }}" type="checkbox" [formControlName]="e[0]">
                <label for="plugin-{{ e[0] }}" [title]="e[1].config?.description || ''">{{ e[1].name || e[0] || e[1].tag }}</label>
                <span *ngIf="e[1].config?.experimental">🧪️</span>
                <span *ngIf="needsPluginUpdate(e[0])" class="update">
              <span class="fake-link no-select" (click)="updatePlugin($any(e[0]))" i18n>🌟️ update</span>
            </span>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>
    </div>
  </form>
  <span *ngIf="serverError.length || installMessages.length" class="log mobile-hide">
    <div *ngFor="let e of serverError" class="error">{{ e }}</div>
    <div *ngFor="let i of installMessages">{{ i }}</div>
  </span>
</div>
